<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To-Do App</title>
    <link rel="stylesheet" href="style.css">
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const taskList = document.getElementById("taskList");
            const taskInput = document.getElementById("task");
            const updateInput = document.getElementById("updateTask");
            const updateIdInput = document.getElementById("updateTaskId");
            const messageBox = document.getElementById("messageBox");  // Elemento para exibir mensagens

            // Função para exibir mensagem
            function showMessage(message) {
                messageBox.textContent = message;
                messageBox.style.display = 'block';
                setTimeout(() => {
                    messageBox.style.display = 'none';
                }, 3000); // Mensagem desaparece após 3 segundos
            }

            // Função para listar as tarefas
            function loadTasks() {
                fetch('http://localhost:5000/api/tasks')
                    .then(response => response.json())
                    .then(data => {
                        taskList.innerHTML = '';
                        data.forEach(task => {
                            let li = document.createElement('li');
                            li.classList.add('task-item');
                            li.innerHTML = `
                                <span class="task-text">${task.task}</span>
                                <div class="task-actions">
                                    <button class="edit-btn">Editar</button>
                                    <button class="delete-btn">Excluir</button>
                                </div>
                            `;
                            
                            // Editar e Excluir
                            const editBtn = li.querySelector('.edit-btn');
                            const deleteBtn = li.querySelector('.delete-btn');

                            editBtn.onclick = function () {
                                updateInput.value = task.task;
                                updateIdInput.value = task.id;
                            };

                            deleteBtn.onclick = function () {
                                deleteTask(task.id);
                            };

                            taskList.appendChild(li);
                        });
                    });
            }

            // Função para adicionar uma nova tarefa
            document.getElementById("addTaskForm").addEventListener("submit", function (e) {
                e.preventDefault();
                const taskData = { task: taskInput.value };

                fetch('http://localhost:5000/api/tasks', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(taskData)
                })
                .then(response => response.json())
                .then(data => {
                    loadTasks();
                    taskInput.value = '';
                    showMessage("Tarefa adicionada com sucesso!"); // Exibe a mensagem
                });
            });

            // Função para atualizar uma tarefa
            document.getElementById("updateTaskForm").addEventListener("submit", function (e) {
                e.preventDefault();
                const taskId = updateIdInput.value;
                const updatedData = { task: updateInput.value };

                fetch(`http://localhost:5000/api/tasks/${taskId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(updatedData)
                })
                .then(response => response.json())
                .then(data => {
                    loadTasks();
                    updateInput.value = '';
                    updateIdInput.value = '';
                    showMessage("Tarefa atualizada com sucesso!"); // Exibe a mensagem
                });
            });

            // Função para excluir uma tarefa
            function deleteTask(taskId) {
                const confirmDelete = window.confirm("Tem certeza que deseja excluir esta tarefa?");
                if (confirmDelete) {
                    fetch(`http://localhost:5000/api/tasks/${taskId}`, {
                        method: 'DELETE',
                    })
                    .then(response => response.json())
                    .then(data => {
                        loadTasks();
                        showMessage("Tarefa excluída com sucesso!"); // Exibe a mensagem
                    });
                }
            }

            // Carregar as tarefas ao iniciar
            loadTasks();
        });
    </script>
</head>
<body>
    <h1>Lista de Tarefas</h1>

    <!-- Caixa de mensagem de sucesso -->
    <div id="messageBox" style="display:none; background-color: #4CAF50; color: white; padding: 10px; margin-bottom: 15px; border-radius: 5px;"></div>

    <!-- Formulário para adicionar uma nova tarefa -->
    <form id="addTaskForm">
        <input type="text" id="task" placeholder="Digite a tarefa" required>
        <button type="submit">Adicionar Tarefa</button>
    </form>

    <!-- Formulário para editar uma tarefa existente -->
    <form id="updateTaskForm">
        <input type="hidden" id="updateTaskId">
        <input type="text" id="updateTask" placeholder="Editar tarefa" required>
        <button type="submit">Atualizar Tarefa</button>
    </form>

    <ul id="taskList"></ul>
</body>
</html>
